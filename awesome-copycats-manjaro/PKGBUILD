# Maintainer: megvadulthangya <megvadulthangya@gmail.com>
pkgname=awesome-copycats-manjaro
pkgver=r1058.e42b863
pkgrel=1
pkgdesc="A forked and enhanced version of the original Awesome WM Copycats repository."
arch=('any')
url="https://github.com/megvadulthangya/awesome-copycats-manjaro"
license=('GPL3')

# --- MÓDOSÍTÁS: Függőségek beállítása ---
# Ezek kellenek, hogy a Quake terminál és a config funkciói (háttér, copy-paste) működjenek az ISO-n.
# A lain-git és awesome-freedesktop-git maradt, feltételezve, hogy ezeket is építed a repódban.
depends=()

makedepends=('git')
source=("git+https://github.com/megvadulthangya/awesome-copycats-manjaro.git#branch=nord")
sha256sums=('SKIP')

pkgver() {
  # Ez most már biztonságos, mert a prepare() nem törli ki alóla a .git-et
  cd "$srcdir/awesome-copycats-manjaro"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  # A prepare most üres vagy törölhető. 
  # SOHA ne töröld itt a .git mappát, mert kell a pkgver-nek!
  true
}

package() {
  # Belépünk a letöltött forrás mappájába
  cd "$srcdir/awesome-copycats-manjaro"
   
  # Célmappa létrehozása
  install -d -m755 "$pkgdir/etc/skel/.config/awesome"
   
  # MÁSOLÁS: A 'cp -a' mindent másol (rejtett fájlokat is), rekurzívan, jogokkal együtt.
  # Mivel a scratch.lua ott van a git repódban, itt automatikusan átmásolódik!
  cp -a . "$pkgdir/etc/skel/.config/awesome/"
   
  # TISZTÍTÁS: Most, hogy már a csomagban ($pkgdir) van minden,
  # INNEN töröljük ki a .git mappát.
  rm -rf "$pkgdir/etc/skel/.config/awesome/.git"
  rm -rf "$pkgdir/etc/skel/.config/awesome/.gitignore"
  rm -rf "$pkgdir/etc/skel/.config/awesome/.github" 2>/dev/null || true
   
  # Template átnevezése (ha létezik)
  if [ -f "$pkgdir/etc/skel/.config/awesome/rc.lua.template" ]; then
    mv "$pkgdir/etc/skel/.config/awesome/rc.lua.template" "$pkgdir/etc/skel/.config/awesome/rc.lua"
  fi
   
  # Jogosultságok beállítása (biztos, ami biztos)
  find "$pkgdir/etc/skel/.config/awesome" -type f -exec chmod 644 {} \;
  find "$pkgdir/etc/skel/.config/awesome" -type d -exec chmod 755 {} \;
   
  # Install script létrehozása
  install -d -m755 "$pkgdir/usr/share/$pkgname"
  cat > "$pkgdir/usr/share/$pkgname/install-to-user.sh" << 'EOF'
#!/bin/bash
if [ -d "$HOME/.config/awesome" ]; then
  echo "Backing up existing Awesome config to $HOME/.config/awesome.backup"
  mv "$HOME/.config/awesome" "$HOME/.config/awesome.backup"
fi
echo "Installing Awesome WM Nord configuration to $HOME/.config/awesome"
cp -r /etc/skel/.config/awesome "$HOME/.config/"
echo "Installation complete! Restart Awesome WM with Mod+Ctrl+R"
EOF
   
  chmod +x "$pkgdir/usr/share/$pkgname/install-to-user.sh"
   
  # README
  install -d -m755 "$pkgdir/usr/share/doc/$pkgname"
  cat > "$pkgdir/usr/share/doc/$pkgname/README" << EOF
Awesome WM Nord Configuration
Run the installation script: /usr/share/$pkgname/install-to-user.sh
EOF
}
