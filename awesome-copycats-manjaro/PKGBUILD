# Maintainer: megvadulthangya <megvadulthangya@gmail.com>
pkgname=awesome-copycats-manjaro
pkgver=r62.b635c89
pkgrel=1
pkgdesc="A forked and enhanced version of the original Awesome WM Copycats repository."
arch=('any')
url="https://github.com/megvadulthangya/awesome-copycats-manjaro"
license=('GPL3')
depends=('awesome-git' 'lain-git' 'awesome-freedesktop-git')
makedepends=('git')
source=("git+https://github.com/megvadulthangya/awesome-copycats-manjaro.git#branch=nord")
sha256sums=('SKIP')

pkgver() {
  cd "$srcdir/awesome-copycats-manjaro"
  # Form√°tum: r<commits>.<hash>
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  cd "$srcdir/awesome-copycats-manjaro"
  # Remove git related files
  find . -name '.git*' -exec rm -rf {} + 2>/dev/null || true
}

package() {
  cd "$srcdir"
  
  install -d -m755 "$pkgdir/etc/skel/.config/awesome"
  cp -r awesome-copycats-manjaro/* "$pkgdir/etc/skel/.config/awesome/"
  
  shopt -s dotglob
  for file in awesome-copycats-manjaro/.*; do
    if [[ -f "$file" && "$file" != *".git"* ]]; then
      cp "$file" "$pkgdir/etc/skel/.config/awesome/"
    fi
  done
  shopt -u dotglob
  
  if [ -f "$pkgdir/etc/skel/.config/awesome/rc.lua.template" ]; then
    mv "$pkgdir/etc/skel/.config/awesome/rc.lua.template" "$pkgdir/etc/skel/.config/awesome/rc.lua"
  fi
  
  find "$pkgdir/etc/skel/.config/awesome" -type f -exec chmod 644 {} \;
  find "$pkgdir/etc/skel/.config/awesome" -type d -exec chmod 755 {} \;
  
  install -d -m755 "$pkgdir/usr/share/$pkgname"
  cat > "$pkgdir/usr/share/$pkgname/install-to-user.sh" << 'EOF'
#!/bin/bash
if [ -d "$HOME/.config/awesome" ]; then
  echo "Backing up existing Awesome config to $HOME/.config/awesome.backup"
  mv "$HOME/.config/awesome" "$HOME/.config/awesome.backup"
fi
echo "Installing Awesome WM Nord configuration to $HOME/.config/awesome"
cp -r /etc/skel/.config/awesome "$HOME/.config/"
echo "Installation complete! Restart Awesome WM with Mod+Ctrl+R"
EOF
  
  chmod +x "$pkgdir/usr/share/$pkgname/install-to-user.sh"
  
  install -d -m755 "$pkgdir/usr/share/doc/$pkgname"
  cat > "$pkgdir/usr/share/doc/$pkgname/README" << EOF
Awesome WM Nord Configuration
Run the installation script: /usr/share/$pkgname/install-to-user.sh
EOF
}
