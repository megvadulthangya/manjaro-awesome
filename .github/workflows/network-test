name: Upload Test - Complete Environment

on:
  workflow_dispatch:
    inputs:
      test_file_size_mb:
        description: 'Test file size in MB'
        default: '5'
        type: string
      use_compression:
        description: 'Use compression for transfer'
        default: 'true'
        type: boolean

jobs:
  upload-test:
    runs-on: ubuntu-latest
    container:
      image: archlinux:base-devel

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Prepare Test Environment
        run: |
          echo "=== TESZT KÃ–RNYEZET ELÅKÃ‰SZÃTÃ‰SE ==="
          echo "DÃ¡tum: $(date)"
          echo "Git commit: $(git rev-parse --short HEAD 2>/dev/null || echo 'N/A')"
          
          pacman-key --init
          pacman-key --populate archlinux
          
          # Csak a szÃ¼ksÃ©ges csomagok, rsync is telepÃ­tve
          pacman -Syu --noconfirm --needed \
            git rsync openssh \
            base-devel sudo coreutils \
            curl wget jq bc \
            parallel  # PÃ¡rhuzamos feltÃ¶ltÃ©shez
          
          # Builder user lÃ©trehozÃ¡sa
          useradd -m builder
          echo "builder ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
          
          # Git konfigurÃ¡ciÃ³
          git config --system --add safe.directory '*'
          export GIT_DISCOVERY_ACROSS_FILESYSTEM=1
          
          chown -R builder:builder .
          
          echo "=== RENDSZER INFORMÃCIÃ“ ==="
          echo "Hostname: $(hostname)"
          echo "Container ID: $(cat /etc/machine-id 2>/dev/null || echo 'N/A')"
          echo "SSH: $(ssh -V 2>&1)"
          echo "RSYNC: $(rsync --version | head -1)"
          echo "Available disk: $(df -h / | tail -1)"

      - name: Setup SSH and Environment Variables
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== KÃ–RNYEZETI VÃLTOZÃ“K BEÃLLÃTÃSA ==="
          
          # Minden vÃ¡ltozÃ³t environment fÃ¡jlba mentÃ¼nk
          cat > /tmp/env_vars.sh << EOF
          export REMOTE_DIR="$REMOTE_DIR"
          export VPS_USER="$VPS_USER"
          export VPS_HOST="$VPS_HOST"
          export BUILD_TIMESTAMP="$(date +%s)"
          export TEST_PREFIX="github_test_\${BUILD_TIMESTAMP}"
          EOF
          
          # Debug informÃ¡ciÃ³
          echo "REMOTE_DIR: $REMOTE_DIR"
          echo "VPS_USER: $VPS_USER"
          echo "VPS_HOST: $VPS_HOST"
          
          if [ -z "$REMOTE_DIR" ] || [ -z "$VPS_USER" ] || [ -z "$VPS_HOST" ]; then
            echo "âŒ HIBA: Egy vagy tÃ¶bb secret nincs beÃ¡llÃ­tva!"
            echo "SzÃ¼ksÃ©ges secrets: REMOTE_DIR, VPS_USER, VPS_HOST, VPS_SSH_KEY"
            exit 1
          fi
          
          # SSH kÃ¶nyvtÃ¡r lÃ©trehozÃ¡sa
          mkdir -p /home/builder/.ssh
          
          # SSH kulcs ellenÅ‘rzÃ©se Ã©s mentÃ©se
          echo "${{ secrets.VPS_SSH_KEY }}" | base64 -d > /home/builder/.ssh/id_ed25519
          chmod 600 /home/builder/.ssh/id_ed25519
          
          # Kulcs informÃ¡ciÃ³k
          echo "=== SSH KULCS INFO ==="
          ssh-keygen -l -f /home/builder/.ssh/id_ed25519
          
          # SSH config
          cat > /home/builder/.ssh/config << EOF
Host $VPS_HOST
    HostName $VPS_HOST
    User $VPS_USER
    IdentityFile ~/.ssh/id_ed25519
    StrictHostKeyChecking no
    ConnectTimeout 30
    ServerAliveInterval 15
    ServerAliveCountMax 3
    LogLevel DEBUG3
EOF
          
          # Known hosts
          echo "Adding host to known_hosts..."
          ssh-keyscan -H $VPS_HOST >> /home/builder/.ssh/known_hosts 2>/dev/null
          
          # JogosultsÃ¡gok
          chown -R builder:builder /home/builder/.ssh
          
          # Environment fÃ¡jl mÃ¡solÃ¡sa builder szÃ¡mÃ¡ra
          cp /tmp/env_vars.sh /home/builder/env_vars.sh
          chown builder:builder /home/builder/env_vars.sh
          
          echo "=== SSH BEÃLLÃTÃSOK KÃ‰SZ ==="

      - name: Create Test Files
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
        run: |
          echo "=== TESZT FÃJLOK LÃ‰TREHOZÃSA ==="
          
          # Ugyanaz a struktÃºra, mint az eredeti scriptben
          OUTPUT_DIR="/home/builder/built_packages"
          mkdir -p $OUTPUT_DIR
          
          # Random fÃ¡jlnevek (mint valÃ³di csomagok)
          TEST_PREFIX="github_test_$(date +%s)"
          
          # 5MB fÃ¡jl (mint egy kisebb csomag)
          echo "Creating 5MB test package..."
          dd if=/dev/urandom of="$OUTPUT_DIR/${TEST_PREFIX}-test-5mb-1.0-1-x86_64.pkg.tar.zst" \
             bs=1M count=5 status=progress 2>&1 | tail -1
          
          # 190MB fÃ¡jl (mint egy nagyobb csomag)
          echo "Creating 190MB test package..."
          dd if=/dev/urandom of="$OUTPUT_DIR/${TEST_PREFIX}-test-large-2.0-1-x86_64.pkg.tar.zst" \
             bs=1M count=190 status=progress 2>&1 | tail -1
          
          # Custom mÃ©retÅ± fÃ¡jl
          CUSTOM_SIZE="${{ github.event.inputs.test_file_size_mb }}"
          echo "Creating ${CUSTOM_SIZE}MB custom test package..."
          dd if=/dev/urandom of="$OUTPUT_DIR/${TEST_PREFIX}-test-custom-1.5-1-x86_64.pkg.tar.zst" \
             bs=1M count=$CUSTOM_SIZE status=progress 2>&1 | tail -1
          
          # AdatbÃ¡zis fÃ¡jl szimulÃ¡lÃ¡sa
          echo "Creating fake database file..."
          cd $OUTPUT_DIR
          tar czf "${TEST_PREFIX}-manjaro-awesome.db.tar.gz" \
            "${TEST_PREFIX}"-*.pkg.tar.zst 2>/dev/null || true
          
          # FÃ¡jl informÃ¡ciÃ³k rÃ©szletesen
          echo "=== FÃJL INFORMÃCIÃ“K ==="
          echo "Directory: $OUTPUT_DIR"
          ls -la "$OUTPUT_DIR/"
          echo ""
          echo "File sizes:"
          ls -lh "$OUTPUT_DIR/"*.pkg.tar.*
          echo ""
          echo "Total size: $(du -sh $OUTPUT_DIR/)"
          echo "File count: $(ls -1 $OUTPUT_DIR/*.pkg.tar.* 2>/dev/null | wc -l)"
          
          # Checksum-ok
          echo "=== CHECKSUM-OK ==="
          for f in "$OUTPUT_DIR"/*.pkg.tar.*; do
            echo "$(basename $f): $(md5sum $f | cut -d' ' -f1)"
          done
          
          # JogosultsÃ¡gok
          chown -R builder:builder $OUTPUT_DIR

      - name: Remote Directory Verification
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== TÃVOLI KÃ–NYVTÃR ELLENÅRZÃ‰SE ==="
          
          # EllenÅ‘rizzÃ¼k, hogy lÃ©tezik-e a tÃ¡voli kÃ¶nyvtÃ¡r
          REMOTE_CMD="
            echo 'Remote host: \$(hostname)';
            echo 'Remote user: \$(whoami)';
            echo 'Checking directory: $REMOTE_DIR';
            if [ -d '$REMOTE_DIR' ]; then
              echo 'âœ“ Directory exists';
              ls -ld '$REMOTE_DIR';
              echo 'Permissions:';
              ls -la '$REMOTE_DIR/' | head -10;
              echo 'Disk usage:';
              df -h '$REMOTE_DIR' 2>/dev/null || df -h | grep -E '/var|/www|/home';
            else
              echo 'âœ— Directory does NOT exist: $REMOTE_DIR';
              echo 'Creating directory...';
              sudo mkdir -p '$REMOTE_DIR' 2>/dev/null || \
              mkdir -p '$REMOTE_DIR' 2>/dev/null || \
              { echo 'Failed to create directory'; exit 1; }
              sudo chown \$USER: '\$REMOTE_DIR' 2>/dev/null || \
              chown \$USER: '$REMOTE_DIR' 2>/dev/null;
              echo 'Directory created with permissions:';
              ls -ld '$REMOTE_DIR';
            fi;
            echo 'Available space:';
            df -h . 2>/dev/null || df -h / 2>/dev/null;
          "
          
          echo "Executing remote check..."
          timeout 45 su builder -c "ssh $VPS_USER@$VPS_HOST '$REMOTE_CMD'"
          
          # ExportÃ¡ljuk a vÃ¡ltozÃ³kat a kÃ¶vetkezÅ‘ lÃ©pÃ©sekhez
          echo "TEST_PREFIX=github_test_$(date +%s)" >> $GITHUB_ENV
          echo "OUTPUT_DIR=/home/builder/built_packages" >> $GITHUB_ENV

      - name: Test SCP Upload with Multiple Files
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== SCP FELTÃ–LTÃ‰S TESZT (TÃ–BB FÃJL) ==="
          
          TIMESTAMP="$(date +%s)"
          OUTPUT_DIR="/home/builder/built_packages"
          
          # FeltÃ¶ltÃ©s minden fÃ¡jlbÃ³l
          for FILE in "$OUTPUT_DIR"/*.pkg.tar.*; do
            if [ -f "$FILE" ]; then
              FILENAME=$(basename "$FILE")
              FILESIZE=$(ls -lh "$FILE" | awk '{print $5}')
              
              echo ""
              echo "=== FELTÃ–LTÃ‰S: $FILENAME ($FILESIZE) ==="
              echo "From: $FILE"
              echo "To: $VPS_USER@$VPS_HOST:$REMOTE_DIR/$FILENAME"
              
              # SCP feltÃ¶ltÃ©s idÅ‘mÃ©rÃ©ssel
              START_TIME=$(date +%s.%N)
              
              if timeout 300 su builder -c "scp \
                -o StrictHostKeyChecking=no \
                -o ConnectTimeout=30 \
                '$FILE' \
                '$VPS_USER@$VPS_HOST:$REMOTE_DIR/$FILENAME'"; then
                
                END_TIME=$(date +%s.%N)
                DURATION=$(echo "$END_TIME - $START_TIME" | bc)
                echo "âœ… Sikeres feltÃ¶ltÃ©s"
                echo "â±ï¸  IdÅ‘: ${DURATION}s"
                
                # EllenÅ‘rzÃ©s
                echo "EllenÅ‘rzÃ©s a szerveren..."
                su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' \
                  'ls -lh \"$REMOTE_DIR/$FILENAME\" && \
                   echo \"MD5: \$(md5sum \"$REMOTE_DIR/$FILENAME\" 2>/dev/null | cut -d\" \" -f1)\"'"
              else
                echo "âŒ SCP hiba"
                SCP_ERROR=$?
                echo "Exit code: $SCP_ERROR"
                
                # HÃ¡lÃ³zati diagnosztika
                echo "HÃ¡lÃ³zati teszt..."
                timeout 5 su builder -c "ping -c 2 $VPS_HOST 2>/dev/null || echo 'Ping failed'"
                timeout 5 su builder -c "nc -zv -w 3 $VPS_HOST 22 2>&1 || echo 'Port test failed'"
              fi
            fi
          done
          
          echo ""
          echo "=== SCP Ã–SSZEFOGLALÃ“ ==="
          su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' \
            'echo \"Files in $REMOTE_DIR:\"; \
             ls -la \"$REMOTE_DIR/\"*.pkg.tar.* 2>/dev/null | wc -l; \
             echo \"Total size:\"; \
             du -sh \"$REMOTE_DIR\" 2>/dev/null'"

      - name: Test RSYNC Upload with Compression
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== RSYNC FELTÃ–LTÃ‰S TESZT ==="
          
          TIMESTAMP="$(date +%s)"
          OUTPUT_DIR="/home/builder/built_packages"
          RSYNC_TEST_DIR="$REMOTE_DIR/rsync_test_$TIMESTAMP"
          
          echo "RSYNC cÃ©lkÃ¶nyvtÃ¡r: $RSYNC_TEST_DIR"
          echo "ForrÃ¡s: $OUTPUT_DIR/*.pkg.tar.*"
          
          # EllenÅ‘rizzÃ¼k, hogy telepÃ­tve van-e rsync
          if ! command -v rsync >/dev/null; then
            echo "Rsync nincs telepÃ­tve, telepÃ­tÃ©s..."
            pacman -S --noconfirm rsync
          fi
          
          # Rsync opciÃ³k
          RSYNC_OPTS="-avz --progress --stats"
          if [ "${{ github.event.inputs.use_compression }}" = "true" ]; then
            RSYNC_OPTS="$RSYNC_OPTS -z"
            echo "TÃ¶mÃ¶rÃ­tÃ©s hasznÃ¡lata"
          fi
          
          # TÃ¡voli kÃ¶nyvtÃ¡r lÃ©trehozÃ¡sa
          echo "TÃ¡voli kÃ¶nyvtÃ¡r lÃ©trehozÃ¡sa..."
          su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' \
            'mkdir -p \"$RSYNC_TEST_DIR\" && echo \"Directory created\"'"
          
          # Rsync feltÃ¶ltÃ©s
          echo ""
          echo "=== RSYNC FELTÃ–LTÃ‰S INDUL ==="
          START_TIME=$(date +%s.%N)
          
          # Rsync futtatÃ¡sa rÃ©szletes loggal
          su builder -c "
            set -x
            rsync $RSYNC_OPTS \
              -e 'ssh -o StrictHostKeyChecking=no -o ConnectTimeout=30' \
              '$OUTPUT_DIR/'*.pkg.tar.* \
              '$VPS_USER@$VPS_HOST:$RSYNC_TEST_DIR/'
          " 2>&1 | tee /tmp/rsync_output.log
          
          RSYNC_EXIT=$?
          END_TIME=$(date +%s.%N)
          DURATION=$(echo "$END_TIME - $START_TIME" | bc)
          
          echo ""
          echo "=== RSYNC EREDMÃ‰NY ==="
          echo "Exit code: $RSYNC_EXIT"
          echo "IdÅ‘tartam: ${DURATION}s"
          
          if [ $RSYNC_EXIT -eq 0 ]; then
            echo "âœ… RSYNC sikeres"
            
            # Rsync statisztikÃ¡k
            echo ""
            echo "=== RSYNC STATISZTIKÃK ==="
            grep -A 20 "Number of files:" /tmp/rsync_output.log || \
            grep -i "total\|speed\|sent\|received" /tmp/rsync_output.log
            
            # EllenÅ‘rzÃ©s a szerveren
            echo ""
            echo "=== TÃVOLI ELLENÅRZÃ‰S ==="
            su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' \
              'echo \"Files in $RSYNC_TEST_DIR:\"; \
               ls -lh \"$RSYNC_TEST_DIR/\" 2>/dev/null || echo \"Directory not found\"; \
               echo \"File count: \$(ls -1 \"$RSYNC_TEST_DIR/\"*.pkg.tar.* 2>/dev/null | wc -l)\"; \
               echo \"Total size: \$(du -sh \"$RSYNC_TEST_DIR\" 2>/dev/null || echo \"0\")\"'"
          else
            echo "âŒ RSYNC hiba"
            
            # HibaelhÃ¡rÃ­tÃ¡s
            echo ""
            echo "=== HIBAINFÃ“ ==="
            tail -20 /tmp/rsync_output.log
            
            # SSH kapcsolat teszt
            echo ""
            echo "SSH connection test..."
            timeout 10 su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' 'echo SSH OK'" || \
            echo "SSH connection failed"
          fi

      - name: Compare Transfer Methods
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== FELTÃ–LTÃ‰SI MÃ“DSZEREK Ã–SSZEHASONLÃTÃSA ==="
          
          # Ã–sszefoglalÃ³ kÃ©szÃ­tÃ©se
          cat > /tmp/transfer_summary.md << EOF
          # FeltÃ¶ltÃ©si Teszt Ã–sszefoglalÃ³
          
          **DÃ¡tum:** $(date)
          **GitHub Run:** ${{ github.run_id }}
          **ForrÃ¡s kÃ¶nyvtÃ¡r:** /home/builder/built_packages
          **CÃ©l kÃ¶nyvtÃ¡r:** $REMOTE_DIR
          
          ## TesztfÃ¡jlok:
          \`\`\`
          $(ls -lh /home/builder/built_packages/*.pkg.tar.* 2>/dev/null || echo "N/A")
          \`\`\`
          
          ## SCP eredmÃ©ny:
          - FÃ¡jlok feltÃ¶ltve: $(su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' 'ls \"$REMOTE_DIR/\"*.pkg.tar.* 2>/dev/null | wc -l'")
          - UtolsÃ³ SCP exit code: $(echo $?)
          
          ## RSYNC eredmÃ©ny:
          - Rsync exit code: $(tail -1 /tmp/rsync_output.log 2>/dev/null | grep -o 'exit code [0-9]*' || echo "N/A")
          - Ãtviteli sebessÃ©g: $(grep -i 'speedup\|bytes/sec' /tmp/rsync_output.log 2>/dev/null | tail -1 || echo "N/A")
          
          ## AjÃ¡nlÃ¡sok:
          1. **SCP** hasznÃ¡lata, ha egyszerÅ± fÃ¡jlÃ¡tvitelre van szÃ¼ksÃ©g
          2. **RSYNC** hasznÃ¡lata, ha:
             - Nagy fÃ¡jlokat kell Ã¡tvinni
             - TÃ¶bbszÃ¶ri feltÃ¶ltÃ©s (csak a vÃ¡ltozÃ¡sok)
             - HÃ¡lÃ³zati kapcsolat instabil
          3. **Compression** (tÃ¶mÃ¶rÃ­tÃ©s) hasznÃ¡lata, ha:
             - A hÃ¡lÃ³zati sÃ¡vszÃ©lessÃ©g korlÃ¡tozott
             - Nagy fÃ¡jlokat viszÃ¼nk Ã¡t
          
          \`\`\`bash
          # SCP pÃ©lda:
          scp -o StrictHostKeyChecking=no -C file.pkg.tar.zst user@host:/remote/dir/
          
          # RSYNC pÃ©lda:
          rsync -avz --progress -e ssh file.pkg.tar.zst user@host:/remote/dir/
          \`\`\`
          EOF
          
          cat /tmp/transfer_summary.md

      - name: Cleanup Test Files
        env:
          REMOTE_DIR: ${{ secrets.REMOTE_DIR }}
          VPS_USER: ${{ secrets.VPS_USER }}
          VPS_HOST: ${{ secrets.VPS_HOST }}
        run: |
          echo "=== TESZT FÃJLOK TÃ–RLÃ‰SE ==="
          
          TIMESTAMP="$(date +%s)"
          
          # TÃ¶rlÃ©si script
          CLEANUP_SCRIPT="
            echo 'Starting cleanup...';
            echo 'Current directory: \$(pwd)';
            echo '';
            
            # SCP-vel feltÃ¶ltÃ¶tt fÃ¡jlok tÃ¶rlÃ©se
            echo '1. Removing SCP test files...';
            TEST_FILES=\$(ls '$REMOTE_DIR/'github_test_*.pkg.tar.* 2>/dev/null || echo '');
            if [ -n \"\$TEST_FILES\" ]; then
              echo 'Found files:';
              ls -lh '$REMOTE_DIR/'github_test_*.pkg.tar.*;
              rm -f '$REMOTE_DIR/'github_test_*.pkg.tar.*;
              echo 'SCP files removed.';
            else
              echo 'No SCP test files found.';
            fi;
            
            echo '';
            
            # RSYNC teszt kÃ¶nyvtÃ¡rak tÃ¶rlÃ©se
            echo '2. Removing RSYNC test directories...';
            RSYNC_DIRS=\$(find '$REMOTE_DIR/' -type d -name 'rsync_test_*' 2>/dev/null || echo '');
            if [ -n \"\$RSYNC_DIRS\" ]; then
              echo 'Found directories:';
              echo \"\$RSYNC_DIRS\";
              rm -rf '$REMOTE_DIR/'rsync_test_*/ 2>/dev/null;
              echo 'RSYNC directories removed.';
            else
              echo 'No RSYNC test directories found.';
            fi;
            
            echo '';
            echo '3. Final directory state:';
            ls -la '$REMOTE_DIR/' 2>/dev/null | head -20 || echo 'Directory empty or not accessible';
            echo '';
            echo 'Cleanup completed at \$(date)';
          "
          
          echo "Executing cleanup on remote server..."
          timeout 60 su builder -c "ssh -o StrictHostKeyChecking=no '$VPS_USER@$VPS_HOST' '$CLEANUP_SCRIPT'"
          
          # LokÃ¡lis fÃ¡jlok tÃ¶rlÃ©se is
          echo ""
          echo "Cleaning local test files..."
          rm -rf /home/builder/built_packages/*
          echo "Local cleanup done."

      - name: Generate Final Report
        if: always()
        run: |
          echo "=== VÃ‰GJELENTÃ‰S ==="
          echo ""
          echo "ðŸ“Š TESZT Ã–SSZEFOGLALÃ“"
          echo "====================="
          echo ""
          echo "âœ… ElvÃ©gzett tesztek:"
          echo "   - SSH kapcsolat ellenÅ‘rzÃ©se"
          echo "   - TÃ¡voli kÃ¶nyvtÃ¡r ellenÅ‘rzÃ©se"
          echo "   - SCP feltÃ¶ltÃ©s (tÃ¶bb fÃ¡jl)"
          echo "   - RSYNC feltÃ¶ltÃ©s (tÃ¶mÃ¶rÃ­tÃ©ssel)"
          echo "   - FÃ¡jlok ellenÅ‘rzÃ©se a szerveren"
          echo "   - Automatikus takarÃ­tÃ¡s"
          echo ""
          echo "ðŸ”§ HasznÃ¡lt technolÃ³giÃ¡k:"
          echo "   - SSH kulcs hitelesÃ­tÃ©s"
          echo "   - SCP fÃ¡jlÃ¡tvitel"
          echo "   - RSYNC szinkronizÃ¡ciÃ³"
          echo "   - TÃ¶mÃ¶rÃ­tÃ©s (opcionÃ¡lis)"
          echo ""
          echo "ðŸ“ˆ TeljesÃ­tmÃ©ny:"
          echo "   - FÃ¡jlok mÃ©rete: 5MB, 190MB, ${{ github.event.inputs.test_file_size_mb }}MB"
          echo "   - TÃ¶mÃ¶rÃ­tÃ©s: ${{ github.event.inputs.use_compression }}"
          echo ""
          echo "ðŸ” Secrets hasznÃ¡lat:"
          echo "   - REMOTE_DIR: ${{ secrets.REMOTE_DIR }}"
          echo "   - VPS_USER: ${{ secrets.VPS_USER }}"
          echo "   - VPS_HOST: ${{ secrets.VPS_HOST }}"
          echo "   - VPS_SSH_KEY: $(if [ -n "${{ secrets.VPS_SSH_KEY }}" ]; then echo "âœ“ BeÃ¡llÃ­tva"; else echo "âœ— HiÃ¡nyzik"; fi)"
          echo ""
          echo "ðŸ’¡ AjÃ¡nlÃ¡sok az eredeti scripthez:"
          echo "   1. HasznÃ¡lj RSYNC-t nagy fÃ¡jlokhoz"
          echo "   2. Add hozzÃ¡: ServerAliveInterval 15 az SSH-hoz"
          echo "   3. EllenÅ‘rizd a tÃ¡voli kÃ¶nyvtÃ¡r Ã­rÃ¡si jogosultsÃ¡gokat"
          echo "   4. HasznÃ¡lj -C opciÃ³t SCP-vel tÃ¶mÃ¶rÃ­tÃ©shez"
          echo ""
          echo "ðŸ•’ Teszt kezdete: $(date -d @$(cat /tmp/test_start_time 2>/dev/null || echo $(date +%s)) '+%Y-%m-%d %H:%M:%S')"
          echo "ðŸ•’ Teszt vÃ©ge: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          echo "=== TESZT VÃ‰GE ==="
          
          # IdÅ‘mÃ©rÃ©s vÃ©ge
          echo "Total duration: $(($(date +%s) - $(cat /tmp/test_start_time 2>/dev/null || echo $(date +%s)))) seconds"