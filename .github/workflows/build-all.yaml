name: Build Test Package

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Build package
      run: |
        # Create a simple test package
        mkdir -p test-package
        cat > test-package/PKGBUILD << 'EOF'
pkgname=test-package
pkgver=1.0.0
pkgrel=1
pkgdesc="Test package"
arch=('any')

package() {
  echo "This is a test package"
}
EOF
        
        docker run --rm -v $PWD:/workspace manjarolinux/base:latest bash -c "
          cd /workspace/test-package
          useradd -m builder
          su - builder -c 'cd /workspace/test-package && makepkg'
        "

    - name: Create repo
      run: |
        mkdir -p repo
        cp test-package/*.pkg.tar.* repo/ 2>/dev/null || echo "No packages"
        echo "Built packages:"
        ls -la repo/

    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./repo
        force_orphan: true