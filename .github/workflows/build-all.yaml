name: Final Build Test

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Create and build package
      run: |
        # Step 1: Create directory
        mkdir -p /tmp/final-build
        
        # Step 2: Create PKGBUILD line by line
        echo 'pkgname=final-test' > /tmp/final-build/PKGBUILD
        echo 'pkgver=1.0.0' >> /tmp/final-build/PKGBUILD
        echo 'pkgrel=1' >> /tmp/final-build/PKGBUILD
        echo 'arch=any' >> /tmp/final-build/PKGBUILD
        echo 'package() {' >> /tmp/final-build/PKGBUILD
        echo '  :' >> /tmp/final-build/PKGBUILD
        echo '}' >> /tmp/final-build/PKGBUILD
        
        # Step 3: Build in Docker
        docker run --rm \
          -v /tmp/final-build:/build \
          manjarolinux/base:latest \
          bash -c "pacman -Sy base-devel --noconfirm && useradd -m builder && su builder -c 'cd /build && makepkg'"
        
        # Step 4: Show results
        echo "=== BUILD COMPLETED ==="
        ls -la /tmp/final-build/