name: Test Package Build

on:
  push:
    branches: [ main ]

jobs:
  build-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Build test package
      run: |
        # Create temporary directory and PKGBUILD
        mkdir -p /tmp/pkgbuild
        cat > /tmp/pkgbuild/PKGBUILD << 'EOF'
pkgname=test-package
pkgver=1.0.0
pkgrel=1
pkgdesc="Test package"
arch=('any')

package() {
  echo "Test package content"
}
EOF

        # Build in Docker
        docker run --rm \
          -v /tmp/pkgbuild:/build \
          manjarolinux/base:latest \
          bash -c "
            pacman -Syu --noconfirm
            pacman -S --noconfirm base-devel
            useradd -m builder
            su - builder -c 'cd /build && makepkg'
          "

        # Check result
        if find /tmp/pkgbuild -name "*.pkg.tar.*" | grep -q .; then
          echo "✅ SUCCESS: Package was built!"
          find /tmp/pkgbuild -name "*.pkg.tar.*" -exec ls -la {} \;
        else
          echo "❌ FAILED: No package file created"
          exit 1
        fi