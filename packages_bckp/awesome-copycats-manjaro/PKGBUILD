# Maintainer: megvadulthangya <megvadulthangya@gmail.com>
pkgname=awesome-copycats-manjaro
pkgver=1.0
pkgrel=1
pkgdesc="A forked and enhanced version of the original Awesome WM Copycats repository, featuring unified Nordic color scheme across all themes."
arch=('any')
url="https://github.com/megvadulthangya/awesome-copycats-manjaro"
license=('GPL3')
depends=('awesome-git' 'lain-git' 'awesome-freedesktop-git')
makedepends=('git')
source=("git+https://github.com/megvadulthangya/awesome-copycats-manjaro.git#branch=nord")
sha256sums=('SKIP')

prepare() {
  cd "$srcdir/awesome-copycats-manjaro"
  
  # Remove git related files to avoid conflicts
  find . -name '.git*' -exec rm -rf {} + 2>/dev/null || true
}

package() {
  cd "$srcdir"
  
  # Create the target directory in /etc/skel
  install -d -m755 "$pkgdir/etc/skel/.config/awesome"
  
  # Copy all configuration files to /etc/skel/.config/awesome
  cp -r awesome-copycats-manjaro/* "$pkgdir/etc/skel/.config/awesome/"
  
  # Copy hidden files as well (but exclude .git)
  shopt -s dotglob
  for file in awesome-copycats-manjaro/.*; do
    if [[ -f "$file" && "$file" != *".git"* ]]; then
      cp "$file" "$pkgdir/etc/skel/.config/awesome/"
    fi
  done
  shopt -u dotglob
  
  # Rename rc.lua.template to rc.lua
  if [ -f "$pkgdir/etc/skel/.config/awesome/rc.lua.template" ]; then
    mv "$pkgdir/etc/skel/.config/awesome/rc.lua.template" "$pkgdir/etc/skel/.config/awesome/rc.lua"
  fi
  
  # Set proper permissions
  find "$pkgdir/etc/skel/.config/awesome" -type f -exec chmod 644 {} \;
  find "$pkgdir/etc/skel/.config/awesome" -type d -exec chmod 755 {} \;
  
  # Create installation script for existing users
  install -d -m755 "$pkgdir/usr/share/$pkgname"
  cat > "$pkgdir/usr/share/$pkgname/install-to-user.sh" << 'EOF'
#!/bin/bash
# Script to copy Awesome config to user's home directory

if [ -d "$HOME/.config/awesome" ]; then
  echo "Backing up existing Awesome config to $HOME/.config/awesome.backup"
  mv "$HOME/.config/awesome" "$HOME/.config/awesome.backup"
fi

echo "Installing Awesome WM Nord configuration to $HOME/.config/awesome"
cp -r /etc/skel/.config/awesome "$HOME/.config/"

echo "Installation complete! Restart Awesome WM with Mod+Ctrl+R"
EOF
  
  chmod +x "$pkgdir/usr/share/$pkgname/install-to-user.sh"
  
  # Create README
  install -d -m755 "$pkgdir/usr/share/doc/$pkgname"
  cat > "$pkgdir/usr/share/doc/$pkgname/README" << EOF
Awesome WM Nord Configuration

This package installs the Nord theme configuration for Awesome WM to /etc/skel/.config/awesome.

For NEW USERS:
- The configuration will be automatically available when creating new user accounts

For EXISTING USERS:
- Run the installation script: /usr/share/$pkgname/install-to-user.sh  <-- JAVÃTVA
- Or manually copy: cp -r /etc/skel/.config/awesome ~/.config/

Dependencies (install from pacman From manjaro-awesome repo):
- awesome-git
- lain-git
- awesome-freedesktop-git

After installation, restart Awesome WM with Mod+Ctrl+R.
EOF
}
